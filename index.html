<!DOCTYPE html>
<html lang="en-us">
  <head>
    <base href="https://cdn.jsdelivr.net/gh/web-ports/adgac@main/">
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | A Difficult Game About Climbing</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background: #231F20;
        }

        #unity-container {
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
        }
    </style>
  </head>
  <body>
	<div id="loading-text" style="color: white; font-size: 48px; font-family: cursive; text-align: center; margin-top: 20px;"> LOADING... </div>
    <div id="unity-container" class="unity-desktop" hidden>
      <canvas id="unity-canvas" width=960 height=600 tabindex="-1"></canvas>
      <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
          <div id="unity-progress-bar-full"></div>
        </div>
      </div>
    </div>
<script>
  const loadingText = document.getElementById("loading-text");

  async function fetchPart(url, label) {
    loadingText.textContent = `LOADING ${label}…`;
    const res = await fetch(url, { cache: "force-cache" });
    if (!res.ok) throw new Error("Failed to fetch " + url);
    return res.arrayBuffer();
  }

  async function assembleParts(base, start, end, label) {
    const buffers = [];
    let total = end - start + 1;

    for (let i = start; i <= end; i++) {
      loadingText.textContent =
        `${label}: ${i}/${total}`;
      buffers.push(await fetchPart(`${base}.part${i}`, label));
    }

    let totalLength = buffers.reduce((s, b) => s + b.byteLength, 0);
    let merged = new Uint8Array(totalLength);
    let offset = 0;

    for (const b of buffers) {
      merged.set(new Uint8Array(b), offset);
      offset += b.byteLength;
    }

    return URL.createObjectURL(
      new Blob([merged.buffer], { type: "application/octet-stream" })
    );
  }

  (async () => {
    const buildUrl = "Build";

    loadingText.textContent = "ASSEMBLING GAME DATA…";

    const dataUrl = await assembleParts(
      `${buildUrl}/adgac.data`, 1, 14, "DATA"
    );

    const wasmUrl = await assembleParts(
      `${buildUrl}/adgac.wasm`, 1, 3, "WASM"
    );

    loadingText.textContent = "STARTING UNITY…";

    const config = {
      dataUrl,
      frameworkUrl: `${buildUrl}/adgac.framework.js`,
      codeUrl: wasmUrl,
      streamingAssetsUrl: "StreamingAssets",
      companyName: "Pontypants",
      productName: "A Difficult Game About Climbing",
      productVersion: "1.2.61"
    };

    const canvas = document.getElementById("unity-canvas");
    const script = document.createElement("script");
    script.src = `${buildUrl}/adgac.loader.js`;

    script.onload = () => {
      createUnityInstance(canvas, config, (p) => {
        loadingText.textContent = `INITIALIZING… ${Math.floor(p * 100)}%`;
      }).then(() => {
        loadingText.remove();
      });
    };

    document.body.appendChild(script);
  })();
</script>


  </body>
</html>
